# ğŸ• Cerberus è¶…çº§æ–­è¨€ç³»ç»Ÿ Phase 1 (MVP) å®ç°è®¡åˆ’

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**é¡¹ç›®ä»£å·**: "Cerberus" (åœ°ç‹±ä¸‰å¤´çŠ¬)  
**æ ¸å¿ƒç›®æ ‡**: æ„å»ºåŠ¨æ€çš„ã€æœ‰çŠ¶æ€çš„ã€èƒ½ç†è§£è·¨æ¨¡å—å› æœå…³ç³»çš„è¿è¡Œæ—¶éªŒè¯å¼•æ“  
**è®¾è®¡ç†å¿µ**: ä»é€»è¾‘æ­£ç¡®æ€§ (Correctness)ã€æ•°æ®ä¸€è‡´æ€§ (Consistency)ã€æ—¶åºæœ‰æ•ˆæ€§ (Timeliness) ä¸‰ä¸ªç»´åº¦å®ˆæŠ¤ç³»ç»Ÿ

## ğŸ¯ Phase 1 èŒƒå›´å®šä¹‰

### éªŒè¯çš„å¹¿åº¦ (Breadth) - å…¨è¦†ç›–æ–­è¨€
1. **æ•°æ®æœ‰æ•ˆæ€§**: INGESTION_DATA_VALIDITY
2. **è·¯ç”±å¥åº·åº¦**: ROUTING_SUCCESS_RATE  
3. **å…ƒæ•°æ®ç¨³å®šæ€§**: SYMBOL_INDEX_STABILITY
4. **Kçº¿å†…éƒ¨é€»è¾‘**: KLINE_OHLC_CONSISTENCY, KLINE_OPEN_TIME_ACCURACY
5. **åŒç¼“å†²æœºåˆ¶**: BUFFER_SWAP_INTEGRITY
6. **æ•°æ®æŒä¹…åŒ–**: PERSISTENCE_DATA_CONSISTENCY

### éªŒè¯çš„æ·±åº¦ (Depth) - æœ‰çŠ¶æ€éªŒè¯
- å®ç°æœ‰çŠ¶æ€çš„éªŒè¯å™¨ï¼Œæ”¯æŒè·¨äº‹ä»¶çŠ¶æ€è·Ÿè¸ª
- çº¿ç¨‹å®‰å…¨çš„çŠ¶æ€ç®¡ç†ï¼Œä¸ºæ¯ä¸ª symbol-interval ç»„åˆç»´æŠ¤ç‹¬ç«‹çŠ¶æ€
- çŠ¶æ€ç”Ÿå‘½å‘¨æœŸç®¡ç†å’Œè‡ªåŠ¨æ¸…ç†æœºåˆ¶

### éªŒè¯çš„æ—¶åºæ€§ (Timeliness) - æ€§èƒ½ç›‘æ§
- å…³é”®æ“ä½œè€—æ—¶æ–­è¨€ (å¦‚ç¼“å†²åŒºäº¤æ¢ < 10ms)
- ç«¯åˆ°ç«¯å»¶è¿Ÿç›‘æ§ (æ•°æ®æ‘„å–åˆ°Kçº¿æ›´æ–° < 1ms)
- å‘¨æœŸæ€§ä»»åŠ¡èŠ‚æ‹éªŒè¯

## ğŸ—ï¸ æ ¸å¿ƒæ¶æ„è®¾è®¡

### ä¸»è¦ç»„ä»¶
```
CerberusEngine (æ ¸å¿ƒéªŒè¯å¼•æ“)
â”œâ”€â”€ ValidationRuleRegistry (éªŒè¯è§„åˆ™æ³¨å†Œè¡¨)
â”œâ”€â”€ StatefulValidationManager (æœ‰çŠ¶æ€éªŒè¯ç®¡ç†å™¨)  
â”œâ”€â”€ ValidationEventCollector (éªŒè¯äº‹ä»¶æ”¶é›†å™¨)
â””â”€â”€ PerformanceMonitor (æ€§èƒ½ç›‘æ§å™¨)
```

### è®¾è®¡åŸåˆ™
- **éä¾µå…¥å¼é›†æˆ**: é€šè¿‡ `tracing` äº‹ä»¶é’©å­æ³¨å…¥éªŒè¯é€»è¾‘
- **æ€§èƒ½ä¼˜å…ˆ**: éªŒè¯å¼€é”€ < 1%ï¼Œæ”¯æŒè¿è¡Œæ—¶å¼€å…³
- **æ¸è¿›å¼å¯ç”¨**: æ”¯æŒæŒ‰è§„åˆ™çº§åˆ«åŠ¨æ€å¯ç”¨/ç¦ç”¨
- **çŠ¶æ€éš”ç¦»**: æ¯ä¸ª symbol-interval ç»„åˆç‹¬ç«‹çŠ¶æ€ç®¡ç†

## ğŸ“ æ–‡ä»¶ç»“æ„è§„åˆ’

### æ–°å¢æ ¸å¿ƒæ–‡ä»¶
```
src/klaggregate/
â”œâ”€â”€ cerberus_engine.rs      # Cerberus éªŒè¯å¼•æ“æ ¸å¿ƒå®ç°
â”œâ”€â”€ cerberus_rules.rs       # Phase 1 å…·ä½“éªŒè¯è§„åˆ™å®ç°  
â”œâ”€â”€ cerberus_types.rs       # Cerberus ä¸“ç”¨æ•°æ®ç±»å‹
â””â”€â”€ cerberus_config.rs      # é…ç½®ç®¡ç†å’Œè¿è¡Œæ—¶æ§åˆ¶
```

### ç°æœ‰æ–‡ä»¶é›†æˆç‚¹
```
src/klaggregate/
â”œâ”€â”€ market_data_ingestor.rs     # æ•°æ®æ‘„å–éªŒè¯ç‚¹
â”œâ”€â”€ trade_event_router.rs       # è·¯ç”±å¥åº·åº¦éªŒè¯ç‚¹
â”œâ”€â”€ symbol_kline_aggregator.rs  # Kçº¿é€»è¾‘éªŒè¯ç‚¹
â”œâ”€â”€ buffered_kline_store.rs     # åŒç¼“å†²éªŒè¯ç‚¹
â”œâ”€â”€ kline_data_persistence.rs   # æŒä¹…åŒ–éªŒè¯ç‚¹
â”œâ”€â”€ symbol_metadata_registry.rs # å…ƒæ•°æ®ç¨³å®šæ€§éªŒè¯ç‚¹
â”œâ”€â”€ mod.rs                      # ç³»ç»Ÿé›†æˆç‚¹
â””â”€â”€ observability.rs            # tracing å±‚é›†æˆç‚¹
```

## ğŸ”§ è¯¦ç»†å®ç°è®¡åˆ’

### 1. market_data_ingestor.rs ä¿®æ”¹ç‚¹

**éªŒè¯ç‚¹ 1**: `process_websocket_message` å‡½æ•° (çº¦ç¬¬ 120-150 è¡Œ)
```rust
// éªŒè¯è§„åˆ™: INGESTION_DATA_VALIDITY
// éªŒè¯å†…å®¹: ä»·æ ¼ã€æ•°é‡ã€æ—¶é—´æˆ³åˆç†æ€§æ£€æŸ¥
// è§¦å‘æ—¶æœº: WebSocket æ¶ˆæ¯è§£ææˆåŠŸå
```

**éªŒè¯ç‚¹ 2**: `handle_agg_trade` å‡½æ•° (çº¦ç¬¬ 180-200 è¡Œ)  
```rust
// éªŒè¯è§„åˆ™: æ•°æ®å®Œæ•´æ€§æ£€æŸ¥
// éªŒè¯å†…å®¹: æ•°æ®å­—æ®µå®Œæ•´æ€§ï¼Œè®°å½•æ•°æ®æµå…¥äº‹ä»¶
// è§¦å‘æ—¶æœº: å‘é€åˆ°è·¯ç”±å™¨å‰
```

### 2. trade_event_router.rs ä¿®æ”¹ç‚¹

**éªŒè¯ç‚¹ 1**: `route_trade_event` å‡½æ•° (çº¦ç¬¬ 75-115 è¡Œ)
```rust
// éªŒè¯è§„åˆ™: ROUTING_SUCCESS_RATE  
// éªŒè¯å†…å®¹: è·¯ç”±æˆåŠŸç‡ç»Ÿè®¡å’Œé˜ˆå€¼æ£€æŸ¥
// è§¦å‘æ—¶æœº: è·¯ç”±æˆåŠŸ/å¤±è´¥å
```

**éªŒè¯ç‚¹ 2**: `register_aggregator` å‡½æ•° (çº¦ç¬¬ 45-65 è¡Œ)
```rust
// éªŒè¯è§„åˆ™: èšåˆå™¨æ³¨å†Œå®Œæ•´æ€§
// éªŒè¯å†…å®¹: ç¡®ä¿æ‰€æœ‰å¿…è¦çš„èšåˆå™¨éƒ½å·²æ³¨å†Œ
// è§¦å‘æ—¶æœº: èšåˆå™¨æ³¨å†Œæ—¶
```

### 3. symbol_kline_aggregator.rs ä¿®æ”¹ç‚¹

**éªŒè¯ç‚¹ 1**: `process_agg_trade` å‡½æ•° (çº¦ç¬¬ 130-180 è¡Œ)
```rust
// éªŒè¯è§„åˆ™: KLINE_OHLC_CONSISTENCY
// éªŒè¯å†…å®¹: OHLC é€»è¾‘å…³ç³»æ£€æŸ¥ (open <= high, low <= close ç­‰)
// è§¦å‘æ—¶æœº: Kçº¿æ•°æ®æ›´æ–°å‰
```

**éªŒè¯ç‚¹ 2**: `update_kline_for_period` å‡½æ•° (çº¦ç¬¬ 220-280 è¡Œ)
```rust
// éªŒè¯è§„åˆ™: KLINE_OPEN_TIME_ACCURACY
// éªŒè¯å†…å®¹: å¼€ç›˜æ—¶é—´å‘¨æœŸè¾¹ç•Œå¯¹é½æ£€æŸ¥
// è§¦å‘æ—¶æœº: Kçº¿ç”Ÿæˆæ—¶
```

**éªŒè¯ç‚¹ 3**: `finalize_kline` å‡½æ•° (çº¦ç¬¬ 300-320 è¡Œ)
```rust
// éªŒè¯è§„åˆ™: KLINE_MONOTONIC_INCREASE (æœ‰çŠ¶æ€)
// éªŒè¯å†…å®¹: åŒä¸€å“ç§åŒä¸€å‘¨æœŸKçº¿æ—¶é—´å•è°ƒé€’å¢
// è§¦å‘æ—¶æœº: Kçº¿æœ€ç»ˆåŒ–æ—¶
```

### 4. buffered_kline_store.rs ä¿®æ”¹ç‚¹

**éªŒè¯ç‚¹ 1**: `swap_buffers` å‡½æ•° (çº¦ç¬¬ 140-180 è¡Œ)
```rust
// éªŒè¯è§„åˆ™: BUFFER_SWAP_INTEGRITY
// éªŒè¯å†…å®¹: äº¤æ¢æ“ä½œå®Œæ•´æ€§å’Œæ€§èƒ½æ£€æŸ¥
// è§¦å‘æ—¶æœº: ç¼“å†²åŒºäº¤æ¢å‰å
```

**éªŒè¯ç‚¹ 2**: `write_kline_data` å‡½æ•° (çº¦ç¬¬ 188-214 è¡Œ)
```rust
// éªŒè¯è§„åˆ™: BUFFER_WRITE_ONLY_TO_WRITE_BUFFER
// éªŒè¯å†…å®¹: ç¡®ä¿åªå‘å†™ç¼“å†²åŒºå†™å…¥æ•°æ®
// è§¦å‘æ—¶æœº: å†™å…¥æ•°æ®æ—¶
```

### 5. kline_data_persistence.rs ä¿®æ”¹ç‚¹

**éªŒè¯ç‚¹ 1**: `persist_kline_batch` å‡½æ•° (çº¦ç¬¬ 245-305 è¡Œ)
```rust
// éªŒè¯è§„åˆ™: PERSISTENCE_DATA_CONSISTENCY
// éªŒè¯å†…å®¹: total_records = updated_records + inserted_records
// è§¦å‘æ—¶æœº: æ‰¹é‡æŒä¹…åŒ–å®Œæˆå
```

**éªŒè¯ç‚¹ 2**: `execute_persistence_task` å‡½æ•° (çº¦ç¬¬ 187-229 è¡Œ)
```rust
// éªŒè¯è§„åˆ™: æŒä¹…åŒ–æ€§èƒ½ç›‘æ§
// éªŒè¯å†…å®¹: æŒä¹…åŒ–å»¶è¿Ÿå’Œååé‡ç›‘æ§
// è§¦å‘æ—¶æœº: æŒä¹…åŒ–ä»»åŠ¡æ‰§è¡Œæ—¶
```

### 6. symbol_metadata_registry.rs ä¿®æ”¹ç‚¹

**éªŒè¯ç‚¹ 1**: `initialize_symbol_info` å‡½æ•° (çº¦ç¬¬ 96-150 è¡Œ)
```rust
// éªŒè¯è§„åˆ™: SYMBOL_INDEX_STABILITY
// éªŒè¯å†…å®¹: ç´¢å¼•åˆ†é…ç¨³å®šæ€§å’Œä¸€è‡´æ€§æ£€æŸ¥
// è§¦å‘æ—¶æœº: å“ç§æ³¨å†Œæ—¶
```

**éªŒè¯ç‚¹ 2**: `batch_get_symbol_listing_times` å‡½æ•° (çº¦ç¬¬ 154-194 è¡Œ)
```rust
// éªŒè¯è§„åˆ™: å…ƒæ•°æ®å®Œæ•´æ€§æ£€æŸ¥
// éªŒè¯å†…å®¹: ä¸Šå¸‚æ—¶é—´æ•°æ®åˆç†æ€§éªŒè¯
// è§¦å‘æ—¶æœº: ä¸Šå¸‚æ—¶é—´æŸ¥è¯¢æ—¶
```

## ğŸ›ï¸ éªŒè¯è§„åˆ™ä¼˜å…ˆçº§

### Critical (å§‹ç»ˆå¼€å¯ï¼Œæ€§èƒ½å¼€é”€ < 0.1%)
- INGESTION_DATA_VALIDITY
- KLINE_OHLC_CONSISTENCY  
- BUFFER_SWAP_INTEGRITY

### Standard (å¼€å‘/æµ‹è¯•ç¯å¢ƒï¼Œæ€§èƒ½å¼€é”€ < 0.5%)
- ROUTING_SUCCESS_RATE
- KLINE_OPEN_TIME_ACCURACY
- PERSISTENCE_DATA_CONSISTENCY

### Diagnostic (é—®é¢˜æ’æŸ¥æ—¶ï¼Œæ€§èƒ½å¼€é”€ < 1%)
- SYMBOL_INDEX_STABILITY
- è¯¦ç»†æ€§èƒ½ç›‘æ§è§„åˆ™
- è·¨æ¨¡å—çŠ¶æ€å…³è”éªŒè¯

## ğŸš€ å®æ–½æ­¥éª¤

### ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ¶æ„ (1-2å¤©)
1. åˆ›å»º Cerberus æ ¸å¿ƒæ–‡ä»¶å’ŒåŸºç¡€æ¶æ„
2. å®ç° StatefulValidator trait å’ŒçŠ¶æ€ç®¡ç†
3. é›†æˆåˆ°ç°æœ‰çš„ tracing ç³»ç»Ÿ

### ç¬¬äºŒé˜¶æ®µï¼šCritical è§„åˆ™ (2-3å¤©)  
1. å®ç° INGESTION_DATA_VALIDITY
2. å®ç° KLINE_OHLC_CONSISTENCY
3. å®ç° BUFFER_SWAP_INTEGRITY
4. é›†æˆåˆ°å…³é”®è·¯å¾„å¹¶æµ‹è¯•

### ç¬¬ä¸‰é˜¶æ®µï¼šStandard è§„åˆ™ (2-3å¤©)
1. å®ç° ROUTING_SUCCESS_RATE
2. å®ç° KLINE_OPEN_TIME_ACCURACY  
3. å®ç° PERSISTENCE_DATA_CONSISTENCY
4. æ·»åŠ æ€§èƒ½ç›‘æ§å’Œç»Ÿè®¡

### ç¬¬å››é˜¶æ®µï¼šå®Œå–„å’Œä¼˜åŒ– (1-2å¤©)
1. å®ç°é…ç½®ç®¡ç†å’Œè¿è¡Œæ—¶æ§åˆ¶
2. æ·»åŠ è¯¦ç»†çš„é”™è¯¯å¤„ç†å’Œæ¢å¤æœºåˆ¶
3. æ€§èƒ½è°ƒä¼˜å’Œå‹åŠ›æµ‹è¯•
4. æ–‡æ¡£å®Œå–„

## âš ï¸ é£é™©æ§åˆ¶ç­–ç•¥

### æ€§èƒ½å½±å“æ§åˆ¶
- æ¯ä¸ªéªŒè¯ç‚¹å¢åŠ å»¶è¿Ÿ < 10Î¼s
- å†…å­˜ä½¿ç”¨å¢åŠ  < 5%
- æ”¯æŒè¿è¡Œæ—¶å®Œå…¨ç¦ç”¨
- é‡‡æ ·éªŒè¯æœºåˆ¶

### é”™è¯¯éš”ç¦»æœºåˆ¶
- éªŒè¯å¤±è´¥ä¸å½±å“ä¸»ä¸šåŠ¡é€»è¾‘
- éªŒè¯å™¨å¼‚å¸¸è‡ªåŠ¨é™çº§
- è¯¦ç»†çš„é”™è¯¯æ—¥å¿—å’Œæ¢å¤æœºåˆ¶
- ç†”æ–­å™¨æ¨¡å¼é˜²æ­¢çº§è”å¤±è´¥

### çŠ¶æ€ç®¡ç†å®‰å…¨
- ä½¿ç”¨ `DashMap` å®ç°é«˜å¹¶å‘çŠ¶æ€è®¿é—®
- åŸºäº TTL çš„è‡ªåŠ¨çŠ¶æ€æ¸…ç†
- å†…å­˜ä½¿ç”¨ç›‘æ§å’Œé™åˆ¶
- çŠ¶æ€æŒä¹…åŒ–æ”¯æŒ (å¯é€‰)

## ğŸ“Š æˆåŠŸæŒ‡æ ‡

### åŠŸèƒ½æŒ‡æ ‡
- [ ] 7ä¸ªæ ¸å¿ƒéªŒè¯è§„åˆ™å…¨éƒ¨å®ç°
- [ ] æœ‰çŠ¶æ€éªŒè¯å™¨æ­£å¸¸å·¥ä½œ
- [ ] éªŒè¯äº‹ä»¶æ­£ç¡®æ”¶é›†å’ŒæŠ¥å‘Š
- [ ] é…ç½®ç®¡ç†åŠŸèƒ½å®Œæ•´

### æ€§èƒ½æŒ‡æ ‡  
- [ ] éªŒè¯å¼€é”€ < 1% (ç›®æ ‡ < 0.5%)
- [ ] å†…å­˜å¢é•¿ < 5%
- [ ] éªŒè¯å»¶è¿Ÿ < 10Î¼s per check
- [ ] çŠ¶æ€ç®¡ç†æ— å†…å­˜æ³„æ¼

### è´¨é‡æŒ‡æ ‡
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 90%
- [ ] é›†æˆæµ‹è¯•é€šè¿‡
- [ ] å‹åŠ›æµ‹è¯•ç¨³å®šè¿è¡Œ 24h+
- [ ] æ–‡æ¡£å®Œæ•´ä¸”å‡†ç¡®

## ğŸ”¬ æŠ€æœ¯å®ç°ç»†èŠ‚

### æœ‰çŠ¶æ€éªŒè¯å™¨è®¾è®¡
```rust
pub trait StatefulValidator: Send + Sync {
    type State: Send + Sync + Clone;

    fn validate(&self, context: &ValidationContext, state: &mut Self::State) -> ValidationResult;
    fn create_initial_state(&self) -> Self::State;
    fn should_cleanup_state(&self, state: &Self::State) -> bool;
    fn get_state_key(&self, context: &ValidationContext) -> String;
}
```

### éªŒè¯ä¸Šä¸‹æ–‡ç»“æ„
```rust
pub struct ValidationContext {
    pub module: String,
    pub operation: String,
    pub timestamp: i64,
    pub fields: HashMap<String, serde_json::Value>,
    pub span_data: Option<HashMap<String, String>>,
    pub trace_id: Option<String>,
}
```

### æ€§èƒ½ä¼˜åŒ–ç­–ç•¥
1. **é‡‡æ ·éªŒè¯**: é«˜é¢‘è§„åˆ™æ”¯æŒé‡‡æ ·ç‡é…ç½® (é»˜è®¤ 10%)
2. **å¼‚æ­¥éªŒè¯**: éå…³é”®è·¯å¾„éªŒè¯å¼‚æ­¥æ‰§è¡Œ
3. **çŠ¶æ€ç¼“å­˜**: ä½¿ç”¨ `DashMap<String, Arc<RwLock<T>>>` å®ç°é«˜å¹¶å‘çŠ¶æ€ç®¡ç†
4. **å†…å­˜æ± **: é¢„åˆ†é…éªŒè¯ä¸Šä¸‹æ–‡å¯¹è±¡æ± ï¼Œå‡å°‘å†…å­˜åˆ†é…å¼€é”€
5. **æ‰¹é‡å¤„ç†**: éªŒè¯äº‹ä»¶æ‰¹é‡å¤„ç†ï¼Œå‡å°‘é”ç«äº‰

### é…ç½®ç®¡ç†
```rust
pub struct CerberusConfig {
    pub enabled: bool,
    pub sampling_rate: f64,  // 0.0 - 1.0
    pub max_state_entries: usize,
    pub state_cleanup_interval_ms: u64,
    pub performance_threshold_ms: f64,
    pub rule_configs: HashMap<String, RuleConfig>,
}

pub struct RuleConfig {
    pub enabled: bool,
    pub level: ValidationLevel,
    pub sampling_rate: Option<f64>,
    pub custom_thresholds: HashMap<String, f64>,
}
```

## ğŸ“‹ å…·ä½“éªŒè¯è§„åˆ™å®ç°

### 1. INGESTION_DATA_VALIDITY
```rust
// éªŒè¯é€»è¾‘:
// - ä»·æ ¼ > 0 ä¸” < 1000000
// - æ•°é‡ > 0 ä¸” < 1000000000
// - æ—¶é—´æˆ³åœ¨åˆç†èŒƒå›´å†… (å½“å‰æ—¶é—´ Â± 1å°æ—¶)
// - å“ç§åç§°æ ¼å¼æ­£ç¡® (å­—æ¯æ•°å­—ç»„åˆï¼Œä»¥USDTç»“å°¾)
```

### 2. ROUTING_SUCCESS_RATE (æœ‰çŠ¶æ€)
```rust
// çŠ¶æ€ç»“æ„:
struct RoutingState {
    success_count: u64,
    total_count: u64,
    last_reset_time: i64,
    consecutive_failures: u32,
}

// éªŒè¯é€»è¾‘:
// - æˆåŠŸç‡ > 95% (å¯é…ç½®)
// - è¿ç»­å¤±è´¥æ¬¡æ•° < 10
// - æ¯å°æ—¶é‡ç½®ç»Ÿè®¡
```

### 3. KLINE_OHLC_CONSISTENCY
```rust
// éªŒè¯é€»è¾‘:
// - low <= open <= high
// - low <= close <= high
// - volume >= 0
// - trade_count >= 0
// - turnover >= 0
// - å¦‚æœ volume > 0ï¼Œåˆ™ trade_count > 0
```

### 4. KLINE_MONOTONIC_INCREASE (æœ‰çŠ¶æ€)
```rust
// çŠ¶æ€ç»“æ„:
struct KlineTimeState {
    last_open_time: i64,
    symbol: String,
    interval: String,
}

// éªŒè¯é€»è¾‘:
// - åŒä¸€å“ç§åŒä¸€å‘¨æœŸçš„Kçº¿å¼€ç›˜æ—¶é—´ä¸¥æ ¼é€’å¢
// - æ—¶é—´é—´éš”ç­‰äºå‘¨æœŸé•¿åº¦
```

## ğŸ› ï¸ é›†æˆå®ç°æ–¹æ¡ˆ

### tracing å±‚é›†æˆ
```rust
impl<S> Layer<S> for CerberusValidationLayer
where
    S: Subscriber + for<'lookup> tracing_subscriber::registry::LookupSpan<'lookup>,
{
    fn on_event(&self, event: &Event<'_>, ctx: Context<'_, S>) {
        // 1. æå–éªŒè¯ä¸Šä¸‹æ–‡
        let validation_context = self.extract_context(event, &ctx);

        // 2. åŒ¹é…é€‚ç”¨çš„éªŒè¯è§„åˆ™
        let applicable_rules = self.rule_registry.get_applicable_rules(&validation_context);

        // 3. æ‰§è¡ŒéªŒè¯ (å¼‚æ­¥ï¼Œä¸é˜»å¡ä¸»çº¿ç¨‹)
        self.execute_validations_async(validation_context, applicable_rules);
    }
}
```

### çŠ¶æ€ç®¡ç†å®ç°
```rust
pub struct StatefulValidationManager {
    states: DashMap<String, Arc<RwLock<Box<dyn Any + Send + Sync>>>>,
    cleanup_scheduler: tokio::time::Interval,
    max_entries: usize,
}

impl StatefulValidationManager {
    pub async fn get_or_create_state<T>(&self, key: &str, creator: impl Fn() -> T) -> Arc<RwLock<T>>
    where T: Send + Sync + 'static {
        // é«˜æ•ˆçš„çŠ¶æ€è·å–æˆ–åˆ›å»ºé€»è¾‘
        // åŒ…å« LRU æ·˜æ±°å’Œå†…å­˜é™åˆ¶
    }
}
```

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•
- æ¯ä¸ªéªŒè¯è§„åˆ™ç‹¬ç«‹æµ‹è¯•
- çŠ¶æ€ç®¡ç†å™¨æµ‹è¯•
- æ€§èƒ½åŸºå‡†æµ‹è¯•

### é›†æˆæµ‹è¯•
- ç«¯åˆ°ç«¯éªŒè¯æµç¨‹æµ‹è¯•
- å¤šçº¿ç¨‹å¹¶å‘æµ‹è¯•
- å†…å­˜æ³„æ¼æµ‹è¯•

### å‹åŠ›æµ‹è¯•
- é«˜é¢‘æ•°æ®ä¸‹çš„æ€§èƒ½æµ‹è¯•
- é•¿æ—¶é—´è¿è¡Œç¨³å®šæ€§æµ‹è¯•
- å¼‚å¸¸æƒ…å†µæ¢å¤æµ‹è¯•

## ğŸ“ˆ ç›‘æ§å’Œå¯è§‚æµ‹æ€§

### éªŒè¯æŒ‡æ ‡
- éªŒè¯è§„åˆ™æ‰§è¡Œæ¬¡æ•°
- éªŒè¯å¤±è´¥ç‡
- éªŒè¯æ‰§è¡Œå»¶è¿Ÿ
- çŠ¶æ€ç®¡ç†å™¨æ€§èƒ½æŒ‡æ ‡

### å‘Šè­¦è§„åˆ™
- éªŒè¯å¤±è´¥ç‡ > 5%
- éªŒè¯å»¶è¿Ÿ > 100Î¼s
- çŠ¶æ€å†…å­˜ä½¿ç”¨ > 100MB
- è¿ç»­éªŒè¯å¼‚å¸¸ > 10æ¬¡

## ğŸ“… è¯¦ç»†å®æ–½æ—¶é—´è¡¨

### Day 1: åŸºç¡€æ¶æ„æ­å»º
**ç›®æ ‡**: å»ºç«‹ Cerberus æ ¸å¿ƒæ¡†æ¶
- [ ] åˆ›å»º `cerberus_types.rs` - æ ¸å¿ƒæ•°æ®ç»“æ„å®šä¹‰
- [ ] åˆ›å»º `cerberus_engine.rs` - éªŒè¯å¼•æ“éª¨æ¶
- [ ] å®ç° `StatefulValidator` trait
- [ ] åŸºç¡€çŠ¶æ€ç®¡ç†å™¨å®ç°
- [ ] å•å…ƒæµ‹è¯•æ¡†æ¶æ­å»º

**äº¤ä»˜ç‰©**: å¯ç¼–è¯‘çš„åŸºç¡€æ¡†æ¶ï¼Œé€šè¿‡åŸºç¡€å•å…ƒæµ‹è¯•

### Day 2: Critical è§„åˆ™å®ç° (ç¬¬ä¸€æ‰¹)
**ç›®æ ‡**: å®ç°æœ€å…³é”®çš„éªŒè¯è§„åˆ™
- [ ] å®ç° `INGESTION_DATA_VALIDITY` è§„åˆ™
- [ ] å®ç° `KLINE_OHLC_CONSISTENCY` è§„åˆ™
- [ ] é›†æˆåˆ° `market_data_ingestor.rs`
- [ ] é›†æˆåˆ° `symbol_kline_aggregator.rs`
- [ ] ç¼–å†™å¯¹åº”çš„å•å…ƒæµ‹è¯•

**äº¤ä»˜ç‰©**: 2ä¸ª Critical è§„åˆ™æ­£å¸¸å·¥ä½œï¼ŒéªŒè¯äº‹ä»¶æ­£ç¡®ç”Ÿæˆ

### Day 3: Critical è§„åˆ™å®Œæˆ + é›†æˆ
**ç›®æ ‡**: å®Œæˆæ‰€æœ‰ Critical è§„åˆ™å¹¶é›†æˆåˆ°ç³»ç»Ÿ
- [ ] å®ç° `BUFFER_SWAP_INTEGRITY` è§„åˆ™
- [ ] é›†æˆåˆ° `buffered_kline_store.rs`
- [ ] å®Œå–„ tracing å±‚é›†æˆ
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•
- [ ] é›†æˆæµ‹è¯•ç¼–å†™

**äº¤ä»˜ç‰©**: æ‰€æœ‰ Critical è§„åˆ™å·¥ä½œæ­£å¸¸ï¼Œæ€§èƒ½å¼€é”€ < 0.1%

### Day 4: Standard è§„åˆ™å®ç°
**ç›®æ ‡**: å®ç° Standard çº§åˆ«éªŒè¯è§„åˆ™
- [ ] å®ç° `ROUTING_SUCCESS_RATE` (æœ‰çŠ¶æ€)
- [ ] å®ç° `KLINE_OPEN_TIME_ACCURACY`
- [ ] é›†æˆåˆ° `trade_event_router.rs`
- [ ] çŠ¶æ€ç®¡ç†å™¨å‹åŠ›æµ‹è¯•
- [ ] å†…å­˜æ³„æ¼æ£€æµ‹

**äº¤ä»˜ç‰©**: Standard è§„åˆ™æ­£å¸¸å·¥ä½œï¼ŒçŠ¶æ€ç®¡ç†ç¨³å®š

### Day 5: æŒä¹…åŒ–éªŒè¯ + é…ç½®ç®¡ç†
**ç›®æ ‡**: å®ŒæˆæŒä¹…åŒ–éªŒè¯å’Œé…ç½®ç³»ç»Ÿ
- [ ] å®ç° `PERSISTENCE_DATA_CONSISTENCY`
- [ ] é›†æˆåˆ° `kline_data_persistence.rs`
- [ ] å®ç°é…ç½®ç®¡ç†ç³»ç»Ÿ
- [ ] è¿è¡Œæ—¶å¼€å…³åŠŸèƒ½
- [ ] é‡‡æ ·ç‡é…ç½®

**äº¤ä»˜ç‰©**: æŒä¹…åŒ–éªŒè¯å·¥ä½œï¼Œæ”¯æŒè¿è¡Œæ—¶é…ç½®

### Day 6: å…ƒæ•°æ®éªŒè¯ + å®Œå–„
**ç›®æ ‡**: å®Œæˆå…ƒæ•°æ®éªŒè¯å’Œç³»ç»Ÿå®Œå–„
- [ ] å®ç° `SYMBOL_INDEX_STABILITY`
- [ ] é›†æˆåˆ° `symbol_metadata_registry.rs`
- [ ] æ€§èƒ½ç›‘æ§å’Œå‘Šè­¦
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] æ–‡æ¡£æ›´æ–°

**äº¤ä»˜ç‰©**: æ‰€æœ‰éªŒè¯è§„åˆ™å®Œæˆï¼Œç³»ç»Ÿç¨³å®šå¯ç”¨

### Day 7: æµ‹è¯•å’Œä¼˜åŒ–
**ç›®æ ‡**: å…¨é¢æµ‹è¯•å’Œæ€§èƒ½ä¼˜åŒ–
- [ ] ç«¯åˆ°ç«¯é›†æˆæµ‹è¯•
- [ ] 24å°æ—¶ç¨³å®šæ€§æµ‹è¯•
- [ ] æ€§èƒ½è°ƒä¼˜
- [ ] ä»£ç å®¡æŸ¥
- [ ] éƒ¨ç½²å‡†å¤‡

**äº¤ä»˜ç‰©**: ç”Ÿäº§å°±ç»ªçš„ Cerberus Phase 1 ç³»ç»Ÿ

## ğŸ¯ é‡Œç¨‹ç¢‘æ£€æŸ¥ç‚¹

### Milestone 1: åŸºç¡€æ¶æ„å®Œæˆ (Day 1 ç»“æŸ)
**éªŒæ”¶æ ‡å‡†**:
- [ ] æ‰€æœ‰æ ¸å¿ƒç±»å‹å®šä¹‰å®Œæˆ
- [ ] StatefulValidator trait å¯ç”¨
- [ ] åŸºç¡€çŠ¶æ€ç®¡ç†å™¨å·¥ä½œæ­£å¸¸
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%

### Milestone 2: Critical è§„åˆ™å®Œæˆ (Day 3 ç»“æŸ)
**éªŒæ”¶æ ‡å‡†**:
- [ ] 3ä¸ª Critical è§„åˆ™å…¨éƒ¨å®ç°
- [ ] é›†æˆåˆ°å…³é”®è·¯å¾„æ— å¼‚å¸¸
- [ ] æ€§èƒ½å¼€é”€ < 0.1%
- [ ] éªŒè¯äº‹ä»¶æ­£ç¡®æ”¶é›†

### Milestone 3: Standard è§„åˆ™å®Œæˆ (Day 5 ç»“æŸ)
**éªŒæ”¶æ ‡å‡†**:
- [ ] æ‰€æœ‰ Standard è§„åˆ™å®ç°
- [ ] æœ‰çŠ¶æ€éªŒè¯å™¨ç¨³å®šå·¥ä½œ
- [ ] é…ç½®ç®¡ç†åŠŸèƒ½å®Œæ•´
- [ ] å†…å­˜ä½¿ç”¨ç¨³å®š

### Milestone 4: ç³»ç»Ÿå®Œæˆ (Day 7 ç»“æŸ)
**éªŒæ”¶æ ‡å‡†**:
- [ ] æ‰€æœ‰éªŒè¯è§„åˆ™æ­£å¸¸å·¥ä½œ
- [ ] 24å°æ—¶ç¨³å®šæ€§æµ‹è¯•é€šè¿‡
- [ ] æ€§èƒ½æŒ‡æ ‡è¾¾æ ‡
- [ ] æ–‡æ¡£å®Œæ•´

## ğŸš¨ é£é™©ç¼“è§£è®¡åˆ’

### æŠ€æœ¯é£é™©
**é£é™©**: æ€§èƒ½å¼€é”€è¶…æ ‡
**ç¼“è§£**:
- æ¯æ—¥æ€§èƒ½åŸºå‡†æµ‹è¯•
- é‡‡æ ·ç‡åŠ¨æ€è°ƒæ•´
- å¼‚æ­¥éªŒè¯æœºåˆ¶

**é£é™©**: çŠ¶æ€ç®¡ç†å†…å­˜æ³„æ¼
**ç¼“è§£**:
- TTL è‡ªåŠ¨æ¸…ç†æœºåˆ¶
- å†…å­˜ä½¿ç”¨ç›‘æ§
- å‹åŠ›æµ‹è¯•éªŒè¯

**é£é™©**: éªŒè¯å™¨å¼‚å¸¸å½±å“ä¸»ä¸šåŠ¡
**ç¼“è§£**:
- å¼‚å¸¸éš”ç¦»æœºåˆ¶
- è‡ªåŠ¨é™çº§åŠŸèƒ½
- ç†”æ–­å™¨ä¿æŠ¤

### è¿›åº¦é£é™©
**é£é™©**: å®ç°å¤æ‚åº¦è¶…é¢„æœŸ
**ç¼“è§£**:
- åˆ†é˜¶æ®µäº¤ä»˜
- æ¯æ—¥è¿›åº¦æ£€æŸ¥
- åŠæ—¶è°ƒæ•´èŒƒå›´

## ğŸ“Š è´¨é‡ä¿è¯è®¡åˆ’

### ä»£ç è´¨é‡
- [ ] ä»£ç å®¡æŸ¥ (æ¯ä¸ª PR)
- [ ] é™æ€åˆ†æå·¥å…·æ£€æŸ¥
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 90%
- [ ] é›†æˆæµ‹è¯•è¦†ç›–ä¸»è¦åœºæ™¯

### æ€§èƒ½è´¨é‡
- [ ] æ¯æ—¥æ€§èƒ½åŸºå‡†æµ‹è¯•
- [ ] å†…å­˜ä½¿ç”¨ç›‘æ§
- [ ] å»¶è¿Ÿåˆ†å¸ƒåˆ†æ
- [ ] é•¿æ—¶é—´ç¨³å®šæ€§æµ‹è¯•

### æ–‡æ¡£è´¨é‡
- [ ] API æ–‡æ¡£å®Œæ•´
- [ ] ä½¿ç”¨ç¤ºä¾‹æ¸…æ™°
- [ ] æ•…éšœæ’æŸ¥æŒ‡å—
- [ ] é…ç½®å‚è€ƒæ–‡æ¡£

---

**é¡¹ç›®å¯åŠ¨**: ç­‰å¾…æœ€ç»ˆç¡®è®¤åç«‹å³å¼€å§‹ Day 1 çš„åŸºç¡€æ¶æ„æ­å»ºå·¥ä½œã€‚

**è”ç³»æ–¹å¼**: å¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–éœ€è¦è°ƒæ•´è®¡åˆ’ï¼Œè¯·åŠæ—¶æ²Ÿé€šã€‚
