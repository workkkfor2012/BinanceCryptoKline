# 自动化日志埋点标准工作流 (SOP)

本流程旨在通过人机协作，分阶段、分层次地为复杂项目生成高质量的、符合架构设计的日志埋点。其核心是"分步确认，逐步求精"。

## 第一阶段：架构与规约一体化生成

此阶段的核心是人机协作，共同创作一份统一的、从宏观架构到微观规约的指导文档。

**最终产出**: `文档/系统架构与日志规约.md`

### 执行步骤

#### 1. 宏观架构建模 (人机第一次交互)

**输入**:
- `项目源代码/`
- `提示词/迭代式架构分析提示词.toml`

**活动**: AI生成包含宏观架构（执行模型、并发单元、数据流、事务边界等）的草案。开发者对草案进行校正和确认。

**交付物**: 一份架构部分已确认的半成品规约文档。

#### 2. 关键函数规约填充 (人机第二次和第三次交互)

**输入**:
- `项目源代码/`
- `提示词/业务函数流程提示词.toml`
- 上一步交付的半成品规约文档

**活动**:

a. **AI定位**: AI在文档中追加一份**【待确认的关键函数清单】**。

b. **人类确认**: 开发者审查并确认这份函数清单的准确性。

c. **AI分析**: AI为清单中的每个函数，填充详细的日志规约（级别、内容、理由等）。

d. **人类审查**: 开发者对AI填充的规约内容进行最终审查和微调。

**交付物**: 一份内容完整、经过三轮确认的最终版 `文档/系统架构与日志规约.md`。

## 第二阶段：自动化代码生成

此阶段的核心是AI作为纯粹的执行者，严格按照最终规约进行代码修改。

**最终产出**: `项目源代码/` (已注入日志埋点)

### 执行步骤

#### 代码自动埋点

**输入**:
- `项目源代码/` (原始版本)
- `提示词/日志埋点提示词.toml`
- **【唯一规约】** `文档/系统架构与日志规约.md`

**活动**: AI将最终规约作为其唯一的、不可违背的行动指令，精确地将日志和追踪代码注入到源代码的相应位置。

**交付物**: 完整的、已注入日志埋点的项目源代码。
